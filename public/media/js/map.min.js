!function(e,t){"use strict";var n,o,a,r,i,s,c,l=t.documentElement,u=10,d=0,f=[];if(!(t.querySelector&&e.JSON&&e.JSON.parse&&e.Object.keys&&e.Array.isArray))return void alert("Sorry, your browser does not support this application.");c=function(){var t,n=e.getComputedStyle(l,""),o=([].slice.call(n).join("").match(/-(moz|webkit|ms)-/)||""===n.OLink&&["","o"])[1],a="WebKit|Moz|MS|O".match(new RegExp("("+o+")","i"))[1],r=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),i=e.navigator;return"ms"===o&&(r.exec(i.userAgent),t=parseFloat(RegExp.$1)),{css:"-"+o+"-",dom:a,lowercase:o,ie:t||!1,js:o[0].toUpperCase()+o.substr(1),platform:i.platform.toLowerCase(),touch:"ontouchstart"in l||"onmsgesturechange"in e?!0:!1}}();var p=function(e,n){return(n||t).querySelector(e)};r=t.documentElement,s=p("#map .googleMap"),i=p("header > nav"),n=p("#modalContentTemplate").innerHTML;var m=function(t,n){var o=e.XMLHttpRequest?new XMLHttpRequest:new e.ActiveXObject("Microsoft.XMLHTTP"),a=n||{},r=a.message||"",i=a.verb||"GET",s=a.headers||{"Content-type":"application/x-www-form-urlencoded"};o.open(i,t,!0),Object.keys(s).forEach(function(e){o.setRequestHeader(e,s[e])}),o.onreadystatechange=function(){var e,t;4===o.readyState&&(t=o.responseText,e=o.status,200>e||e>299?a.fail&&a.fail(t,o):a.success&&a.success(t,o),a.callback&&a.callback(t,e,o),o=null)},o.send(r)},g=function(e){var n,o=t.createElement("i");return o.innerHTML=e,n=o.textContent||o.innerText||"",o=null,n},v=function(e,t){var n=t||"";return Object.keys(e).forEach(function(t){n=n.split("{{"+t+"}}").join(e[t])}),n},h=function(e){var n,e=e||"#modal",o=p(e),a=p("article",o),i=!1,s=function(){return i},c=function(e){return a.innerHTML=e,a.scrollTop=0,h},l=function(e){return n=t.activeElement||null,e&&e.length>0&&c(e),r.className+=" modalActive",o.focus(),i=!0,h},u=function(){return r.className=(" "+r.className+" ").split(" modalActive ").join(" "),t.location.hash="",i=!1,n&&n.focus(),h};return t.addEventListener("keydown",function(e){i===!0&&27===e.keyCode&&u()},!0),p("#closeModal",o).addEventListener("click",u,!1),{active:s,hide:u,populate:c,show:l}}(),y=function(e){h.show(v(e,n)),t.location.hash=e.uri},L=function(e){var t=p("#navigationTemplate").innerHTML,n="";Array.isArray(e.markers)&&(e.markers.forEach(function(e,o){var a=t,r={index:o,title:e.title};n+=v(r,a)}),p("ul",i).innerHTML=n)},k=function(e){var t,n=new google.maps.LatLng(e.lat,e.lng);t=new google.maps.Marker({position:n,map:a,clickable:!0,title:e.title,icon:e.icon||"media/img/themes/red/marker.png"}),e.mark=t,t.addListener("click",function(){a.panTo(t.getPosition()),setTimeout(function(){y(e)},d)}),f.push(e)},E=function(e){Array.isArray(e.markers)&&e.markers.forEach(function(e){k(e)})},w=function(n,r){var i,c;return 200>r||r>399?void(t.location="setup.html"):(o=JSON.parse(n),o.config&&Array.isArray(o.markers)?o.config.map&&o.config.map.lat&&o.config.map.lng?(c=o.config.map,o.config.showOverlayDelay&&(d=o.config.showOverlayDelay),o.config.maxSearchSuggestions&&(u=o.config.maxSearchSuggestions),i=new google.maps.LatLng(parseFloat(c.lat),parseFloat(c.lng)),a=new google.maps.Map(s,{zoom:c.zoom||12,center:i,disableDefaultUI:!0,panControl:!1,mapTypeControl:!1,navigationControl:!1,zoomControl:!1,scaleControl:!0,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},overviewMapControl:!0,styles:c.style||[],mapTypeId:google.maps.MapTypeId.ROADMAP}),e.console&&e.console.log&&google.maps.event.addListener(a,"click",function(e){console.log("Map coordinates: "+e.latLng.lat()+" "+e.latLng.lng())}),E(o),L(o),b.init(o,function(e){e&&y(e)}),setTimeout(function(){var e=p(".intro");e.className+=" hide",e.addEventListener("transitionend",function(){e.className+=" destroy"},!1)},2999),void setTimeout(function(){T(p('header form[role="search"]'),o.markers)},99)):void alert("Sorry, no start coordinates, quitting."):void alert("Could not parse data, sorry :("))};i.addEventListener("click",function(e){var t,n=e.target;"LI"==n.tagName&&(t=parseInt(n.getAttribute("data-index"),10),y(f[t]))},!0),i.addEventListener("mouseover",function(e){var t,n=e.target;"LI"==n.tagName&&(t=parseInt(n.getAttribute("data-index"),10),f[t]&&a.panTo(f[t].mark.getPosition()))});var T=function(e,n,o){var r,i=p("#navigationTemplate").innerHTML,s=u||10,c=p('input[type="search"]',e),l=[];if(!c||!n)return void console.log("No element to attach to or no data to search.");if(!Array.isArray(n))return void console.log("QuikSearch requires an array of objects.");e.addEventListener("submit",function(e){var t;e.preventDefault(),r&&(t=p(".active",r),t&&t.click())},!0),c.setAttribute("autocapitalize","off"),c.setAttribute("autocomplete","off");var d=function(e){var t,n=e.toLowerCase().split(""),o=n.shift(),a="";return t={a:"",e:"",i:"",o:"",u:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,d:3,t:3,l:4,m:5,n:5,r:6},a=o+n.map(function(e){return t[e]}).filter(function(e,n,a){return 0===n?e!==t[o]:e!==a[n-1]}).join(""),(a+"000").slice(0,4).toUpperCase()},m=function(e,t){var n=new RegExp("("+e+")","gi");return t.replace(n,"<strong>$1</strong>")},h=function(){return l};n.forEach(function(e,t){var n={index:t,soundex:[],title:e.title||e.name||t},o="";Object.keys(e).forEach(function(t){var n=e[t];"string"==typeof n&&(o+=" "+g(n).toLowerCase())}),n.str=o,n.words=o.split(" "),n.words.forEach(function(e){n.soundex.push(d(e))}),l.push(n)});var L=function(e){var t,e=e.toLowerCase(),n=[];e.length<2||(e=e.toLowerCase(),t=d(e),l.some(function(o){return(o.str.indexOf(e)>-1||o.soundex.indexOf(t)>-1)&&n.push(o),n.length>s?!0:void 0}),o?o(c,n,e):k(n,e))},k=function(e,n){var o="";r||(r=t.createElement("ul"),r.className="searchSuggest",r.addEventListener("click",function(e){var t=e.target;for(console.log(t.tagName);"LI"!=t.tagName;)t=t.parentNode;y(f[parseInt(t.getAttribute("data-index"),10)])},!0),r.addEventListener("mouseover",function(e){for(var t,n=e.target;"LI"!=n.tagName;)n=n.parentNode;t=parseInt(n.getAttribute("data-index"),10),f[t]&&a.panTo(f[t].mark.getPosition())},!0),c.parentNode.appendChild(r)),e.forEach(function(e,t){var a={itemIndex:t,index:e.index,title:m(n,e.title)};o+=v(a,i)}),r.innerHTML=o||""},E=function(e){var t,n,o,i=r.querySelectorAll("li"),s=p(".active",r),c=i.length-1;if(s){for(t=parseInt(s.getAttribute("data-menu-item"),10),n=0,o=i.length;o>n;n++)i[n].className="";38===e?(t--,0>t&&(t=c)):(t++,t>c&&(t=0))}else t=0,38===e&&(t=c);i[t].className="active";var l=parseInt(i[t].getAttribute("data-index"),10);f[l]&&a.panTo(f[l].mark.getPosition())},w=function(e){var t,n=e.keyCode||0,o=this.value;return 27===n&&c.blur(),38===n||40===n?(e.preventDefault(),void E(n)):27===n?(t=r.querySelectorAll(".active")[0]||p("li",r),void(t&&t.click())):void setTimeout(function(){L(o)},9)};return c.addEventListener("keyup",w,!0),c.addEventListener("blur",function(){c.value="",r&&(r.innerHTML="")},!0),{data:h,search:L}},b=function(){var n,a={};if(e.history&&e.history.pushState){var r=function(e){e&&(e.title&&(t.title=e.title),n&&n(e))},i=function(e,t){var n="#/"+e.toLowerCase().replace(/\W/g," ").split(" ").join("-").trim();return"number"==typeof parseInt(t,0)&&(n+="-"+t),n},s=function(t){e.history.pushState(t,t.title,t.URI)},c=function(e,o){var s=t.location.hash;o&&(n=o),e.markers.forEach(function(e,t){var n=i(e.title,t);a[n]=t,e.uri=n,n===s&&r(e)})},l=function(){var e=t.location.hash,n=a[e];"number"==typeof n?r(o.markers[n]):h.hide()};return e.addEventListener("popstate",l),e.addEventListener("hashchange",l),{init:c,trigger:r,push:s}}}();e.placesOfInterest?alert("TODO: inline data loading here"):m("map.json",{callback:w}),l.className=(" "+l.className+" ua-"+c.lowercase+"  os-"+c.platform+" ie-"+c.ie+" "+(c.touch?"has-touch":"no-touch")+" ").replace(" no-js "," js ").replace(" loading "," loaded ").trim(),function(){c.touch&&p("#closeModal").addEventListener("touchstart",function(){p("#closeModal").click()},!1)}()}(window,document);